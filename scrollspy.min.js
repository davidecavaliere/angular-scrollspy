"use strict";angular.module("davidecavaliere.angular-scrollspy",[]).value("config",{offset:200,delay:100}).run(["PositionFactory",function(PositionFactory){PositionFactory.refreshPositions(),angular.element(window).bind("scroll",function(){PositionFactory.refreshPositions()})}]).factory("PositionFactory",["$rootScope",function($rootScope){return{position:[],refreshPositions:function(){this.position.documentHeight=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight),this.position.windowTop=void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop,this.position.windowBottom=this.position.windowTop+window.innerHeight}}}]).directive("scrollspyTrigger",function(config,scrollspyConfig,PositionFactory,$log){return{restrict:"A",scope:{scrollspyTrigger:"="},link:function(scope,element,attrs){angular.extend(config,scrollspyConfig.config),$log.debug("scrollspyTrigger",scope.scrollspyTrigger),scope.checkActive=function(){parseInt(attrs.scrollspyOffset||config.offset);scope.phase="out";var elementTop=element[0].offsetTop,elementHeight=element[0].offsetHeight,scrollTop=angular.element(document.body)[0].scrollTop,windowHeight=window.innerHeight,windowBottom=scrollTop+window.innerHeight,elementBottom=elementTop+element[0].offsetHeight;windowHeight>elementHeight?elementTop>windowBottom||scrollTop>elementBottom?(scope.phase="out",$log.debug("element ",element,"is "+scope.phase)):elementBottom>windowBottom?(scope.phase="entering",$log.debug("element ",element,"is "+scope.phase)):windowBottom>=elementBottom&&elementTop>=scrollTop?(scope.phase="in",$log.debug("element ",element,"is "+scope.phase)):elementBottom>=scrollTop&&scrollTop>elementTop&&(scope.phase="leaving",$log.debug("element ",element,"is "+scope.phase)):elementTop>windowBottom||scrollTop>elementBottom?(scope.phase="out",$log.debug("element ",element,"is "+scope.phase)):elementTop>=scrollTop?(scope.phase="entering",$log.debug("element ",element,"is "+scope.phase)):elementBottom>scrollTop&&windowBottom>elementBottom?(scope.phase="leaving",$log.debug("element ",element,"is "+scope.phase)):scrollTop>elementTop&&elementBottom>=windowBottom&&(scope.phase="in",$log.debug("element ",element,"is "+scope.phase)),$log.debug("emiting scrollspy:"+scope.scrollspyTrigger,scope.phase),scope.$parent.$broadcast("scrollspy:"+scope.scrollspyTrigger,scope.phase)},config.throttle?angular.element(window).bind("scroll",config.throttle(function(){scope.checkActive()},config.delay)):angular.element(window).bind("scroll",function(){scope.checkActive()}),scope.$$postDigest(function(){scope.checkActive()}),angular.element(window).bind("resize",function(){scope.checkActive()}),element.append(scope.phase)}}}).directive("scrollspyReceiver",function($log){return{restrict:"A",scope:{scrollspyReceiver:"="},link:function(scope,element,attrs){scope.$on("scrollspy:"+scope.scrollspyReceiver,function(event,phase){$log.debug("got scrollspy:"+scope.scrollspyReceiver,phase),"out"==phase?element.removeClass("active"):"in"==phase&&element.addClass("active")})},controller:function($scope,$element,$attrs){}}}).provider("scrollspyConfig",function(){var self=this;return this.config={},this.$get=function(){var extend={};return extend.config=self.config,extend},this});